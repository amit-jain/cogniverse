# Cogniverse Helm Chart Values
# Default values for production deployment

# Global settings
global:
  # Image registry
  imageRegistry: ""
  imagePullSecrets: []
  storageClass: ""

# Image configuration
image:
  registry: docker.io
  repository: cogniverse
  pullPolicy: IfNotPresent
  tag: "2.0.0"

# Namespace
namespaceOverride: ""

# Common labels
commonLabels: {}

# Common annotations
commonAnnotations: {}

# ===========================================
# Vespa Configuration
# ===========================================
vespa:
  enabled: true
  image:
    repository: vespaengine/vespa
    tag: "8.259.19"
    pullPolicy: IfNotPresent

  replicaCount: 1

  resources:
    limits:
      cpu: "8"
      memory: "20Gi"
    requests:
      cpu: "4"
      memory: "8Gi"

  persistence:
    enabled: true
    storageClass: ""
    accessMode: ReadWriteOnce
    size: "100Gi"
    annotations: {}

  service:
    type: ClusterIP
    ports:
      query: 8080
      config: 19071
      metrics: 19092
    annotations: {}

  env:
    VESPA_CONFIGSERVERS: "vespa"
    VESPA_MEMORY_OPTIONS: "-Xms4g -Xmx16g"

  # Health checks
  livenessProbe:
    httpGet:
      path: /state/v1/health
      port: 19071
    initialDelaySeconds: 120
    periodSeconds: 30
    timeoutSeconds: 10
    failureThreshold: 3

  readinessProbe:
    httpGet:
      path: /state/v1/health
      port: 19071
    initialDelaySeconds: 60
    periodSeconds: 20
    timeoutSeconds: 5
    failureThreshold: 3

  nodeSelector: {}
  tolerations: []
  affinity: {}

# ===========================================
# Runtime Configuration
# ===========================================
runtime:
  enabled: true
  image:
    repository: cogniverse/runtime
    tag: "2.0.0"
    pullPolicy: IfNotPresent

  replicaCount: 2

  resources:
    limits:
      cpu: "4"
      memory: "8Gi"
    requests:
      cpu: "2"
      memory: "4Gi"

  service:
    type: ClusterIP
    port: 8000
    annotations: {}

  env:
    RUNTIME_HOST: "0.0.0.0"
    RUNTIME_PORT: "8000"
    LOG_LEVEL: "INFO"
    WORKERS: "4"

  # Autoscaling
  autoscaling:
    enabled: true
    minReplicas: 2
    maxReplicas: 10
    targetCPUUtilizationPercentage: 70
    targetMemoryUtilizationPercentage: 80

  # Health checks
  livenessProbe:
    httpGet:
      path: /health
      port: 8000
    initialDelaySeconds: 60
    periodSeconds: 30
    timeoutSeconds: 5
    failureThreshold: 3

  readinessProbe:
    httpGet:
      path: /health
      port: 8000
    initialDelaySeconds: 30
    periodSeconds: 15
    timeoutSeconds: 3
    failureThreshold: 3

  nodeSelector: {}
  tolerations: []
  affinity:
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 100
          podAffinityTerm:
            labelSelector:
              matchExpressions:
                - key: app.kubernetes.io/component
                  operator: In
                  values:
                    - runtime
            topologyKey: kubernetes.io/hostname

# ===========================================
# Dashboard Configuration
# ===========================================
dashboard:
  enabled: true
  image:
    repository: cogniverse/dashboard
    tag: "2.0.0"
    pullPolicy: IfNotPresent

  replicaCount: 1

  resources:
    limits:
      cpu: "2"
      memory: "4Gi"
    requests:
      cpu: "1"
      memory: "2Gi"

  service:
    type: ClusterIP
    port: 8501
    annotations: {}

  env:
    STREAMLIT_SERVER_PORT: "8501"
    STREAMLIT_SERVER_ADDRESS: "0.0.0.0"
    STREAMLIT_SERVER_ENABLE_CORS: "false"
    STREAMLIT_SERVER_ENABLE_XSRF_PROTECTION: "true"

  # Health checks
  livenessProbe:
    httpGet:
      path: /_stcore/health
      port: 8501
    initialDelaySeconds: 60
    periodSeconds: 30
    timeoutSeconds: 10
    failureThreshold: 3

  readinessProbe:
    httpGet:
      path: /_stcore/health
      port: 8501
    initialDelaySeconds: 30
    periodSeconds: 20
    timeoutSeconds: 5
    failureThreshold: 3

  nodeSelector: {}
  tolerations: []
  affinity: {}

# ===========================================
# Phoenix Configuration
# ===========================================
phoenix:
  enabled: true
  image:
    repository: arizephoenix/phoenix
    tag: "4.11.0"
    pullPolicy: IfNotPresent

  replicaCount: 1

  resources:
    limits:
      cpu: "2"
      memory: "4Gi"
    requests:
      cpu: "1"
      memory: "2Gi"

  persistence:
    enabled: true
    storageClass: ""
    accessMode: ReadWriteOnce
    size: "50Gi"
    annotations: {}

  service:
    type: ClusterIP
    port: 6006
    annotations: {}

  env:
    PHOENIX_WORKING_DIR: "/phoenix-data"
    PHOENIX_PORT: "6006"
    PHOENIX_HOST: "0.0.0.0"

  # Health checks
  livenessProbe:
    httpGet:
      path: /health
      port: 6006
    initialDelaySeconds: 30
    periodSeconds: 30
    timeoutSeconds: 10
    failureThreshold: 3

  readinessProbe:
    httpGet:
      path: /health
      port: 6006
    initialDelaySeconds: 15
    periodSeconds: 20
    timeoutSeconds: 5
    failureThreshold: 3

  nodeSelector: {}
  tolerations: []
  affinity: {}

# ===========================================
# Ollama Configuration
# ===========================================
ollama:
  enabled: true
  image:
    repository: ollama/ollama
    tag: "0.1.22"
    pullPolicy: IfNotPresent

  replicaCount: 1

  resources:
    limits:
      cpu: "8"
      memory: "16Gi"
      nvidia.com/gpu: "1"
    requests:
      cpu: "4"
      memory: "8Gi"
      nvidia.com/gpu: "1"

  persistence:
    enabled: true
    storageClass: ""
    accessMode: ReadWriteOnce
    size: "100Gi"
    annotations: {}

  service:
    type: ClusterIP
    port: 11434
    annotations: {}

  env:
    OLLAMA_HOST: "0.0.0.0:11434"
    OLLAMA_NUM_PARALLEL: "4"
    OLLAMA_MAX_LOADED_MODELS: "2"

  # GPU node selector
  nodeSelector:
    nvidia.com/gpu: "true"

  tolerations:
    - key: nvidia.com/gpu
      operator: Exists
      effect: NoSchedule

  # Health checks
  livenessProbe:
    httpGet:
      path: /api/tags
      port: 11434
    initialDelaySeconds: 120
    periodSeconds: 30
    timeoutSeconds: 10
    failureThreshold: 3

  readinessProbe:
    httpGet:
      path: /api/tags
      port: 11434
    initialDelaySeconds: 60
    periodSeconds: 20
    timeoutSeconds: 5
    failureThreshold: 3

  affinity: {}

# ===========================================
# OTEL Collector Configuration
# ===========================================
otelCollector:
  enabled: true
  image:
    repository: otel/opentelemetry-collector
    tag: "0.92.0"
    pullPolicy: IfNotPresent

  replicaCount: 1

  resources:
    limits:
      cpu: "2"
      memory: "2Gi"
    requests:
      cpu: "500m"
      memory: "512Mi"

  service:
    type: ClusterIP
    ports:
      grpc: 4317
      http: 4318
      metrics: 8888
      health: 13133
    annotations: {}

  config: |
    receivers:
      otlp:
        protocols:
          grpc:
            endpoint: 0.0.0.0:4317
          http:
            endpoint: 0.0.0.0:4318

    processors:
      batch:
        timeout: 10s
        send_batch_size: 1024

    exporters:
      logging:
        loglevel: info

      # Add your exporters here (Jaeger, Prometheus, etc.)

    service:
      pipelines:
        traces:
          receivers: [otlp]
          processors: [batch]
          exporters: [logging]
        metrics:
          receivers: [otlp]
          processors: [batch]
          exporters: [logging]

  nodeSelector: {}
  tolerations: []
  affinity: {}

# ===========================================
# Ingress Configuration
# ===========================================
ingress:
  enabled: true
  className: "nginx"
  annotations:
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    nginx.ingress.kubernetes.io/proxy-body-size: "100m"

  hosts:
    - host: cogniverse.example.com
      paths:
        - path: /api
          pathType: Prefix
          service: runtime
          port: 8000
        - path: /
          pathType: Prefix
          service: dashboard
          port: 8501

  tls:
    - secretName: cogniverse-tls
      hosts:
        - cogniverse.example.com

# ===========================================
# Configuration
# ===========================================
config:
  # Tenant configuration
  tenants:
    - id: "default"
      name: "Default Tenant"
    - id: "acme_corp"
      name: "Acme Corporation"
    - id: "globex_inc"
      name: "Globex Inc"

  # Model configuration
  models:
    colpali:
      name: "vidore/colsmol-500m"
      device: "cuda"
    videoprism:
      name: "google/videoprism-base"
      device: "cuda"
    colqwen:
      name: "colqwen/colqwen2-omni"
      device: "cuda"

  # Ollama models to pull
  ollamaModels:
    - "mistral:7b-instruct"
    - "llama2:13b"

# ===========================================
# Init Jobs
# ===========================================
initJobs:
  # Schema deployment job
  schemaDeployment:
    enabled: true
    image:
      repository: cogniverse/runtime
      tag: "2.0.0"
    resources:
      limits:
        cpu: "1"
        memory: "2Gi"
      requests:
        cpu: "500m"
        memory: "1Gi"
    backoffLimit: 3
    restartPolicy: OnFailure

  # Model pulling job
  modelPulling:
    enabled: true
    image:
      repository: ollama/ollama
      tag: "0.1.22"
    resources:
      limits:
        cpu: "2"
        memory: "4Gi"
      requests:
        cpu: "1"
        memory: "2Gi"
    backoffLimit: 3
    restartPolicy: OnFailure

# ===========================================
# Security
# ===========================================
securityContext:
  runAsNonRoot: true
  runAsUser: 1000
  fsGroup: 1000

podSecurityContext:
  fsGroup: 1000

# Service account
serviceAccount:
  create: true
  annotations: {}
  name: ""

# RBAC
rbac:
  create: true

# Network policies
networkPolicy:
  enabled: false
  policyTypes:
    - Ingress
    - Egress

# ===========================================
# Monitoring
# ===========================================
monitoring:
  # Prometheus ServiceMonitor
  serviceMonitor:
    enabled: false
    namespace: monitoring
    interval: 30s
    scrapeTimeout: 10s

  # Grafana dashboards
  dashboards:
    enabled: false
    namespace: monitoring

# ===========================================
# Secrets
# ===========================================
secrets:
  # External secrets operator
  externalSecrets:
    enabled: false
    backend: aws-secrets-manager
    region: us-east-1

  # Manually provided secrets (for development)
  manual:
    enabled: false
    data: {}

# ===========================================
# Backup
# ===========================================
backup:
  enabled: false
  schedule: "0 2 * * *"  # Daily at 2 AM
  retention: 30  # days
  storageClass: ""
  size: "200Gi"

# ===========================================
# Multi-Tenant
# ===========================================
multiTenant:
  enabled: true
  isolation: "namespace"  # namespace or schema

  # Resource quotas per tenant
  quotas:
    cpu: "10"
    memory: "20Gi"
    storage: "100Gi"
    pods: "50"
