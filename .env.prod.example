# Cogniverse Environment Configuration - Production
# Copy this file to .env.prod and customize for your production environment
# IMPORTANT: Never commit .env.prod with actual secrets to version control

# ========================================
# Application Configuration
# ========================================

# Application version (use specific version tag in production)
VERSION=2.0.0

# Default tenant ID
DEFAULT_TENANT_ID=default

# Log level: INFO or WARNING for production
LOG_LEVEL=INFO

# Python environment
PYTHONUNBUFFERED=1

# ========================================
# Vespa Configuration
# ========================================

# Vespa URLs and ports
VESPA_URL=http://vespa:8080
VESPA_HOST=vespa
VESPA_PORT=8080
VESPA_CONFIG_PORT=19071
VESPA_METRICS_PORT=19092

# Vespa memory settings (production)
VESPA_MEMORY_OPTIONS=-Xms4g -Xmx16g

# ========================================
# Phoenix Configuration
# ========================================

# Phoenix URLs and ports
PHOENIX_URL=http://phoenix:6006
PHOENIX_ENDPOINT=http://phoenix:6006
PHOENIX_HOST=0.0.0.0
PHOENIX_PORT=6006

# Phoenix working directory
PHOENIX_WORKING_DIR=/phoenix-data

# Phoenix project settings
PHOENIX_PROJECT_NAME=production_project
PHOENIX_ENABLED=true

# ========================================
# Ollama Configuration
# ========================================

# Ollama URLs and ports
OLLAMA_URL=http://ollama:11434
OLLAMA_ENDPOINT=http://ollama:11434
OLLAMA_HOST=0.0.0.0
OLLAMA_PORT=11434

# Ollama performance settings (production)
OLLAMA_NUM_PARALLEL=4
OLLAMA_MAX_LOADED_MODELS=2
OLLAMA_ORIGINS=http://runtime:8000

# Default LLM model for routing (use efficient models in production)
LLM_MODEL=mistral:7b-instruct
LLM_TEMPERATURE=0.0

# ========================================
# Runtime API Configuration
# ========================================

# Runtime server settings
RUNTIME_HOST=0.0.0.0
RUNTIME_PORT=8000
RUNTIME_URL=http://runtime:8000

# Runtime workers (Uvicorn) - scale based on CPU cores
RUNTIME_WORKERS=4
RUNTIME_REPLICAS=2

# API rate limiting (stricter for production)
RATE_LIMIT_PER_MINUTE=100

# ========================================
# Dashboard Configuration
# ========================================

# Streamlit server settings
STREAMLIT_SERVER_PORT=8501
STREAMLIT_SERVER_ADDRESS=0.0.0.0
STREAMLIT_SERVER_ENABLE_CORS=false
STREAMLIT_SERVER_ENABLE_XSRF_PROTECTION=true

# Dashboard URL
DASHBOARD_URL=http://dashboard:8501

# ========================================
# OpenTelemetry Configuration
# ========================================

# OTEL Collector URLs
OTLP_ENDPOINT=http://otel-collector:4317
OTEL_EXPORTER_OTLP_ENDPOINT=http://otel-collector:4317
OTEL_EXPORTER_OTLP_PROTOCOL=grpc

# OTEL service name
OTEL_SERVICE_NAME=cogniverse-runtime-prod

# OTEL tracing
OTEL_TRACES_EXPORTER=otlp
OTEL_METRICS_EXPORTER=otlp
OTEL_LOGS_EXPORTER=otlp

# OTEL sampling (production)
OTEL_TRACES_SAMPLER=parentbased_traceidratio
OTEL_TRACES_SAMPLER_ARG=0.1  # Sample 10% of traces

# ========================================
# Mem0 Configuration
# ========================================

# Mem0 API settings (use secrets manager for production)
# DO NOT commit actual API keys to version control
MEM0_API_KEY=${MEM0_API_KEY}
MEM0_PROJECT_ID=production_project

# Memory settings
MEMORY_ENABLED=true
MEMORY_BACKEND=mem0

# ========================================
# Model Configuration
# ========================================

# ColPali model
COLPALI_MODEL_NAME=vidore/colsmol-500m
COLPALI_DEVICE=cuda
COLPALI_CACHE_DIR=/root/.cache/huggingface

# VideoPrism model
VIDEOPRISM_MODEL_NAME=google/videoprism-base
VIDEOPRISM_DEVICE=cuda
VIDEOPRISM_CACHE_DIR=/root/.cache/huggingface

# ColQwen model
COLQWEN_MODEL_NAME=colqwen/colqwen2-omni
COLQWEN_DEVICE=cuda
COLQWEN_CACHE_DIR=/root/.cache/huggingface

# Hugging Face token (use secrets manager)
HUGGINGFACE_TOKEN=${HUGGINGFACE_TOKEN}

# ========================================
# Ingestion Configuration
# ========================================

# Video processing (production settings)
MAX_FRAMES_PER_VIDEO=500
FRAME_EXTRACTION_FPS=1
VIDEO_CHUNK_DURATION=30

# Batch processing (increase for production)
INGESTION_BATCH_SIZE=50
INGESTION_MAX_WORKERS=8

# ========================================
# Search Configuration
# ========================================

# Default search settings
DEFAULT_SEARCH_LIMIT=20
DEFAULT_RANKING_STRATEGY=hybrid_float_bm25
DEFAULT_RERANK_STRATEGY=colbert_maxsim

# Search timeout (milliseconds)
SEARCH_TIMEOUT_MS=500

# ========================================
# Routing Configuration
# ========================================

# Routing strategy
ROUTING_STRATEGY=gliner_based
ROUTING_OPTIMIZER=GEPA

# Routing model settings
GLINER_MODEL=urchade/gliner_multi-v2.1
ROUTING_CONFIDENCE_THRESHOLD=0.7  # Higher threshold for production

# ========================================
# Cache Configuration
# ========================================

# Cache settings (production)
CACHE_ENABLED=true
CACHE_TTL=7200
CACHE_MAX_SIZE=10000

# Redis cache (if using external cache)
REDIS_URL=redis://localhost:6379/0
REDIS_PASSWORD=${REDIS_PASSWORD}

# ========================================
# Security Configuration
# ========================================

# API keys (use secrets manager in production)
# DO NOT commit actual keys to version control
API_KEY=${API_KEY}

# CORS settings (restrict to your domain)
CORS_ORIGINS=https://your-domain.com,https://dashboard.your-domain.com
CORS_CREDENTIALS=true

# JWT settings (use secrets manager for production)
JWT_SECRET_KEY=${JWT_SECRET_KEY}
JWT_ALGORITHM=HS256
JWT_ACCESS_TOKEN_EXPIRE_MINUTES=30

# SSL/TLS settings
SSL_ENABLED=true
SSL_CERT_PATH=/etc/ssl/certs/cogniverse.crt
SSL_KEY_PATH=/etc/ssl/private/cogniverse.key

# ========================================
# Database Configuration (if applicable)
# ========================================

# PostgreSQL (if using external metadata store)
POSTGRES_HOST=postgres
POSTGRES_PORT=5432
POSTGRES_DB=cogniverse
POSTGRES_USER=cogniverse
POSTGRES_PASSWORD=${POSTGRES_PASSWORD}

# ========================================
# Data Directories
# ========================================

# Data paths (mounted volumes in production)
DATA_DIR=/data
VIDEO_DIR=/data/videos
OUTPUTS_DIR=/app/outputs
LOGS_DIR=/logs

# ========================================
# Feature Flags
# ========================================

# Enable/disable features
ENABLE_TELEMETRY=true
ENABLE_CACHING=true
ENABLE_MEMORY=true
ENABLE_EXPERIMENTS=true

# ========================================
# Production Settings
# ========================================

# Debug mode (always false in production)
DEBUG=false

# Auto-reload (always false in production)
RELOAD=false

# Profiling (disable in production unless troubleshooting)
ENABLE_PROFILING=false

# Health check settings
HEALTH_CHECK_INTERVAL=30
HEALTH_CHECK_TIMEOUT=5

# ========================================
# Monitoring & Alerting
# ========================================

# Prometheus metrics
PROMETHEUS_ENABLED=true
PROMETHEUS_PORT=9090

# Alert endpoints
ALERT_WEBHOOK_URL=${ALERT_WEBHOOK_URL}
ALERT_EMAIL=${ALERT_EMAIL}

# ========================================
# JAX Configuration
# ========================================

# JAX platform (use gpu in production for better performance)
JAX_PLATFORM_NAME=cpu

# ========================================
# GPU Configuration
# ========================================

# CUDA settings (all available GPUs)
CUDA_VISIBLE_DEVICES=0,1,2,3

# GPU memory settings (production)
GPU_MEMORY_FRACTION=0.9

# ========================================
# Backup & Recovery
# ========================================

# Backup settings
BACKUP_ENABLED=true
BACKUP_SCHEDULE="0 2 * * *"  # Daily at 2 AM
BACKUP_RETENTION_DAYS=30
BACKUP_S3_BUCKET=${BACKUP_S3_BUCKET}
BACKUP_S3_REGION=us-east-1

# ========================================
# Scaling Configuration
# ========================================

# Horizontal Pod Autoscaler settings (for K8s)
HPA_MIN_REPLICAS=2
HPA_MAX_REPLICAS=10
HPA_TARGET_CPU_PERCENTAGE=70
HPA_TARGET_MEMORY_PERCENTAGE=80

# ========================================
# Network Configuration
# ========================================

# Internal network
NETWORK_SUBNET=172.28.0.0/16

# External access
EXTERNAL_DOMAIN=cogniverse.your-domain.com
EXTERNAL_PORT=443

# ========================================
# Tenant Configuration
# ========================================

# Multi-tenant settings
DEFAULT_TENANTS=acme_corp globex_inc default

# Tenant resource limits
TENANT_MAX_STORAGE_GB=100
TENANT_MAX_VIDEOS=10000
TENANT_MAX_QPS=100

# ========================================
# Compliance & Auditing
# ========================================

# Audit logging
AUDIT_LOG_ENABLED=true
AUDIT_LOG_LEVEL=INFO
AUDIT_LOG_RETENTION_DAYS=90

# Data retention
DATA_RETENTION_DAYS=365
LOG_RETENTION_DAYS=90

# ========================================
# Notes for Production Deployment
# ========================================

# 1. Replace all ${VARIABLE} placeholders with actual values from secrets manager
# 2. Never commit this file with actual secrets to version control
# 3. Use environment-specific secrets management (AWS Secrets Manager, HashiCorp Vault, etc.)
# 4. Regularly rotate API keys and passwords
# 5. Monitor all service endpoints with the health_check.sh script
# 6. Set up alerting for service failures
# 7. Configure log aggregation and monitoring (ELK, Datadog, etc.)
# 8. Enable SSL/TLS for all external endpoints
# 9. Use network policies to restrict inter-service communication
# 10. Regularly backup Vespa data and Phoenix experiments
