schema agent_memories {
    document agent_memories {
        field id type string {
            indexing: summary | attribute
        }

        field embedding type tensor<float>(d0[768]) {
            indexing: summary | attribute | index
            attribute {
                distance-metric: angular
            }
            index {
                hnsw {
                    max-links-per-node: 16
                    neighbors-to-explore-at-insert: 200
                }
            }
        }

        field text type string {
            indexing: summary | index
            index: enable-bm25
        }

        field user_id type string {
            indexing: summary | attribute
            attribute: fast-search
        }

        field agent_id type string {
            indexing: summary | attribute
            attribute: fast-search
        }

        field metadata_ type string {
            indexing: summary
        }

        field created_at type long {
            indexing: summary | attribute
        }
    }

    fieldset default {
        fields: text
    }

    rank-profile semantic_search {
        inputs {
            query(q) tensor<float>(d0[768])
        }

        first-phase {
            expression: closeness(field, embedding)
        }

        match-features {
            closeness(field, embedding)
            distance(field, embedding)
        }
    }

    rank-profile bm25 {
        first-phase {
            expression: bm25(text)
        }
    }

    rank-profile hybrid {
        inputs {
            query(q) tensor<float>(d0[768])
        }

        first-phase {
            expression: 0.7 * closeness(field, embedding) + 0.3 * bm25(text)
        }

        match-features {
            closeness(field, embedding)
            bm25(text)
        }
    }
}
